<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Feed Reader</title>
  <link rel="stylesheet" href="../css/app.css">
  <link rel="stylesheet" href="../css/bootstrap.css">
 <!-- <script src="lib/angular/angular.js"></script>
  <script src="js/app.js"></script>
  <script src="js/controllers.js"></script>
  <script src="js/filters.js"></script>
  <script src="js/services.js"></script>
  <script src="lib/angular/angular-resource.js"></script>-->


    <script src="../lib/angular/angular.js"></script>
    <script src="../lib/angular/angular-resource.js"></script>
    <!--<script src="~/Scripts/underscore.js"></script>-->

    <script>

        angular.module("videoApp", ["videoService"]);

        angular.module("videoService", ["ngResource"]).
                factory("Video", function ($resource) {
                    return $resource(
                            "/rest/feedReader/feeds/:id",
                            {id: "@@id" },
                            { "update": {method:"PUT"} }
                    );
                });

        var VideoController = function ($scope, Video) {


            var createVideo = function (newVideo) {
                newVideo.$save();
                $scope.videos.push(newVideo);
            };

            var updateVideo = function(video) {
                video.$update();
            };

            $scope.showEdit = function () {
                $scope.isEditVisible = true;
                $scope.editableVideo = new Video();
            };

            $scope.saveVideo = function (video) {
                $scope.isEditVisible = false;
                if (video.id) {
                    updateVideo(video);
                }
                else {
                    createVideo(video);
                }
            };

            $scope.editVideo = function (video) {
                $scope.isEditVisible = true;
                $scope.editableVideo = video;
            };

            $scope.deleteVideo = function (video) {
                video.$delete();
                $scope.videos = _.without($scope.videos, video);
            };

            $scope.isEditVisible = false;
            $scope.videos = Video.query();
        };

    </script>
</head>
<body>

<div ng-app="videoApp" ng-controller="VideoController">

    <table>
        <thead>
        <th>title</th>
        <th>description</th>
        <th></th>
        </thead>
        <tbody>
        <tr data-id="{{video.id}}" ng-repeat="video in videos">
            <td>{{video.title}}</td>
            <td>{{video.description}}</td>
            <td>
                <button ng-click="editVideo(video)">Edit</button>
                <button ng-click="deleteVideo(video)">Delete</button>
            </td>
        </tr>
        </tbody>
    </table>

    <button ng-click="showEdit()">Create Video</button>

    <div ng-show="isEditVisible">
        <hr />
        <form>
            <input type="hidden" ng-model="editableVideo.id" />
            <label>title:</label>
            <input type="text" ng-model="editableVideo.title" required />
            <label>description</label>
            <input type="number" ng-model="editableVideo.description" min="1" max="360" />
            <input type="submit" value="Save" ng-click="saveVideo(editableVideo)" />
        </form>
    </div>

</div>

</body>
</html>
